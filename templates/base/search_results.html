{% extends "base/main.html" %}
{% load app_filters %}

{% block content %}
<div class="container my-4">
    <div class="card shadow-sm">
        <div class="card-header bg-light">
            {% if query %}
                <h4 class="mb-0">Resultados de la búsqueda para: <span class="text-primary">"{{ query }}"</span></h4>
            {% else %}
                <h4 class="mb-0">Por favor, introduce un término de búsqueda.</h4>
            {% endif %}
        </div>
        <div class="card-body">
            {% if query and has_results %}
                {% if ambientes %}
                    <h5>Ambientes</h5>
                    <ul class="list-group list-group-flush mb-4">
                        {% for item in ambientes %}
                            <li class="list-group-item">
                                <a href="{% url 'ambiente:ambiente_detail' item.pk %}" class="fw-bold text-decoration-none text-primary-hover">{{ item.nombre }}</a>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if estantes %}
                    <h5>Estantes</h5>
                    <ul class="list-group list-group-flush mb-4">
                        {% for item in estantes %}
                            <li class="list-group-item">
                                <a href="{% url 'ambiente:estante_detail' item.pk %}" class="fw-bold text-decoration-none text-primary-hover">{{ item.nombre }}</a>
                                <br>{{ item|get_full_path }}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if archivadores %}
                    <h5>Archivadores</h5>
                    <ul class="list-group list-group-flush mb-4">
                        {% for item in archivadores %}
                            <li class="list-group-item">
                                <a href="{% url 'ambiente:archivador_detail' item.pk %}" class="fw-bold text-decoration-none text-primary-hover">{{ item.nombre }}</a>
                                <br>{{ item|get_full_path }}
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}

                {% if archivos %}
                    <h5>Archivos</h5>
                    <ul class="list-group list-group-flush mb-4">
                        {% for item in archivos %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <a href="{% url 'ambiente:archivo_detail' item.pk %}" class="fw-bold text-decoration-none text-primary-hover">{{ item.nombre }}</a>
                                    <br>{{ item|get_full_path }}
                                </div>
                                <button type="button" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#archivoModal-{{ item.pk }}">
                                    <i class="fas fa-eye me-1"></i> Ver Archivo
                                </button>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}

            {% elif query %}
                <div class="text-center p-5">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No se encontraron resultados para "{{ query }}".</h5>
                    <p>Intenta con otro término de búsqueda.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

{% if archivos %}
    {% for item in archivos %}
        {% if item.archivo %}
        <div class="modal fade" id="archivoModal-{{ item.pk }}" tabindex="-1" aria-labelledby="archivoModalLabel-{{ item.pk }}" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="archivoModalLabel-{{ item.pk }}">{{ item.nombre }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% if item.archivo|is_image %}
                            <img src="{{ item.archivo|bust_cache_url }}" class="img-fluid" style="max-height: 80vh; margin: auto; display: block;" alt="{{ item.nombre }}">
                        {% else %}
                            <iframe src="{{ item.archivo|bust_cache_url }}" style="width:100%; height:75vh;" frameborder="0"></iframe>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    {% endfor %}
{% endif %}
{% endblock content %}